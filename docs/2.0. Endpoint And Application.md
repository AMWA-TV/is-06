# AMWA NMOS Network Control API Specification: Endpoint and Application

_(c) AMWA 2017, CC Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)_

### Endpoint API

The Network will gather the following information about an endpoint.  They are:
* the MAC address of the endpoint 
* the IP address that is used to send or receive a flow 
* the switch ID and finally
* the Ethernet Interface to which the endpoint is connected.

The steps involved in the overall discovery process is as follows:
The endpoint hosts register themselves with the RDS using the Node API defined in IS-04. The endpoint refered here in IS-06 maps to the Interface (Node+Interface) in the IS-04 document. The Broadcast Controller (BC) learns of the endpoint hosts from the RDS. The BC uses the endpoint host details to register the endpoints in Network Controller using this IS-06 API. The endpoint API is used for the endpoint regsiteration and it has the following Key elements: 

- ID: This ID is generated by the BC for each endpoint.  The ID is used as an identifier for the endpoint in the communication between the BC and the NC.
- Chassis ID: Optional Parameter. If the endpoint supports LLDP and has had an LLDP exchange with the Network switch, it has to provide a Chassis ID and a Port ID as they are mandatory elements of an LLDP exchange. The same pieces of information are shared by the endpoint with the RDS and then onto the BC. BC includes them in the POST request. 
- Port ID: The Port ID is a MAC address. This is the endpoint MAC address and shared by the endpoint with the RDS and onto the BC. The notation used for the MAC address is: "Hexadecimal representation is a sequence of octet values in which the values of the individual octets are displayed in order from left to right, with each octet value represented as a 2-digit hexadecimal numeral and with the resulting pairs of hexadecimal digits separated by hyphens." [From IEEE Std 802-2014]. This was discussed in the IS-06 workgroup thread:
https://basecamp.com/1791706/projects/12900329/messages/67744660

The above mechanism works for both physical and virtual endpoints. The Port ID will refer to the physical MAC address for a Physical endpoint and to a MAC address assigned to the vNIC for a Virtual Endpoint.

The Network uses the MAC ID to locate the endpoint and to authorize it as an allowed Media endpoint. The Network discovers which switch and port that the endpoint is connected to in the following ways:

- Protocols like ARP and LLDP between the endpoint and the switch provide the MAC address.  The endpoints are required to do ARP, at the minimum, to allow the network to discover the endpoint. 
- If the endpoints sends a flow or sends an IGMP join, the MAC address can be found in the source MAC in the header of the flow.
- The POST Endpoint API optionally provides an ability for a braodcast controller to provide this information. though this is not recommended as there is a possibility of a conflict, it is provided for unique scenarios. Conflict resolutions are not considered in this case.

The network will capture the MAC address announced via ARP or LLDP and also the Source MAC in an incoming packet. 

With above details, the Network learns where an endpoint is connected, namely the switch and the interface of the switch. This is necessary for routing of flows. The NC can then manage flow policies for any endpoint by associating its ID, MAC and IP address to the discovered network switch interface. In case of virtual endpoint, the source vNIC MAC will match the one supplied to the NC while endpoint creation. 

The intention of this registeration process by the BC using the endpoint API is to eliminate a chance that a misconfigured or rogue endpoints sends or receives traffic into the fabric without being part of the Media system. The network will not admit flows and will also not accept IGMP join requests from unregistered endpoints.

Exceptions can be made administratively for the above using the fabric. This may be needed in other workflows such as file-based. These are outside the scope of this API workgroup. 

### Application API

Note that the name “Application” is not well received. Any suggestion for a suitable name to describe the following is welcome. It maps to the IS-04 sender and/or the receiver.   

The BC sends an ID, IP address and optional a UDP/TCP port with the POST request for an Application. 

The key piece of information needed by the network to send or receive traffic is the IP address of the sender or receiver. Hence, it is necessary for the BC to tell the NC what applications or IP addresses are hosted in the endpoints and whether they are senders, receivers, or both. 
The ID provided in the POST request by the BC is used to represent the applciation in all communication between the BC and the NC. This ID is also generated by the BC on behalf of the IS-04 sender or receiver.  

The IP Address for this POST request originates from the Interface binding of the sender or receiver. These are shared with the RDS and then onto the BC, which the BC shares with the NC.
