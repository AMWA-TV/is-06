# AMWA NMOS Network Control API Specification: Endpoint and Application

_(c) AMWA 2017, CC Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)_

### Endpoint API

Endpoints are registered in the Network Controller (NC) using the endpoint API. The endpoint hosts register themselves with the RDS. The Broadcast Controller (BC) learns of the endpoint hosts from the RDS. BC uses the endpoint host details to create the endpoints in NC. It achieves this via the POST Endpoint API. The key elements of the Endpoint API are as follows:

- ID: This is a GUID originally generated by the endpoint itself and passed to the RDS and then to the BC. The BC includes this ID in its POST API. The ID is used as an identifier for the endpoint in other APIs.
- Chassis ID: Optional Parameter. If the endpoint supports LLDP and has had an LLDP exchange with the Network switch, it has to provide a Chassis ID and a Port ID as they are mandatory elements for an LLDP exchange. The same pieces of information are shared by the endpoint with the RDS and then onto the BC. BC includes them in the POST request. 
- Port ID: The Port ID is a MAC address. This is the endpoint MAC address and shared by the endpoint with the RDS and onto the BC. 

The above mechanism works for both physical and virtual endpoints. The Port ID will refer to the physical MAC address for a Physical endpoint and to a MAC address assigned to the vNIC for a Virtual Endpoint.

The Network uses the MAC ID to locate the endpoint and to authorize it as an allowed Media endpoint. The Network discovers the endpoint in many ways:

- Protocols like ARP and LLDP between the endpoint and the switch provide the MAC address
- If the endpoints sends a flow or sends an IGMP join, the MAC address can be found in the source MAC in the header of the flow.
- In rare occasions, it can be statically provided in the POST Endpoint API. Conflict resolution is not considered in this case.

The network will capture the MAC address announced via ARP or LLDP and also the Source MAC in an incoming packet. 

With above details, the Network learns where an endpoint is connected, namely the switch and the interface of the switch. This is necessary for routing of flows. The NC can then manage flow policies for any endpoint by associating its ID and MAC address to the discovered network switch interface. In case of virtual endpoint, the source vNIC MAC will match the one supplied to the NC while endpoint creation. The default flow flow policy is deny. The network will not admit flows from endpoints that are not being created using the Endpoint API first. The network will also not accept IGMP join requests from unknown endpoints.

Exceptions can be made administratively for other endpoints using the fabric for other workflows such as file-based. These are outside the scope of this API workgroup. 

### Application API

Note that the name “Application” is not well received. Any suggestion for a suitable name to describe the following is welcome.

The key piece of information needed by the network to send or receive traffic is the IP address of the sender or receiver. Hence, it is necessary for the BC to tell the NC what applications or IP addresses are hosted in the endpoints and whether they are senders, receivers, or both. The POST of Application API performs this function. The POST API provides an ID for all future reference. The properties of an application are IP Address, UDP port (optional) and its role which may be a sender or a receiver or both. 

The IP Address for this POST request originates from the Interface binding of the sender or receiver. These are shared with the RDS and then onto the BC, which the BC shares with the NC.
